### 华中步兵代码学习笔记

```
if (Status.ShootMode != Shoot_Fire_Mode && Status.ShootMode != Shoot_Powerdown_Mode && RC_Ctl.mouse.press_l == 1)
    {
        Status.ShootMode = Shoot_Fire_Mode;
    }//手动射击抢断自瞄
```

  当步兵不处于开火状态并且不处于断电状态但是此时鼠标左键处于按下状态时 将步兵调整为开火状态 实现手动射击抢断自瞄的效果



```
    if ((waitFlag[5] < 50) && (waitFlag[5] > 0)) //短按     //延时可以调一调
    {
        if (mouse_Press_l_rising_flag == 1)
        {
            waitFlag[5] = 0;
            if (Shoot.HeatControl.IsShootAble == 1) // Heat_Limit
            {
                if (ABS(Bodan_Pos - PidBodanMotorPos.SetPoint) < PluckThreholdPos && F405.Fric_Flag == 1)
                {
                    MirocPosition -= Onegrid;
                    Shoot.ShootContinue = 0;
                }
            }
        }
    }
```

  当`waitflag[5]`大于0小于50时 即此时鼠标左键短按 如果此时鼠标不再处于按下状态即确保鼠标为短按 则将`waitflag[5]`置为0 如果此时的`Shoot.HeatControl.IsShootable`处于1 即可以开火的的状态时 如果此时拨弹电机的位置和设定的拨弹电机的位置差小于阈值 说明此时拨弹过快 则将控制拨盘旋转的变量`MirocPosition`减小预设好的变化值 然后停止连续射击 防止下次射击拨弹过快



```
if (waitFlag[5] > 100) //长按
{
    if (Shoot.HeatControl.IsShootAble == 1)
    {
        if (ABS(Bodan_Pos - PidBodanMotorPos.SetPoint) < PluckThreholdPos && F405.Fric_Flag == 1)
        {
        	Shoot.ShootContinue = 1;
        }
    }
}
```

当`waitflag[5]`大于100时 即此时鼠标左键长按 如果此时处于可以开火的状态 如果拨弹电机的位置和设定的拨弹电机的位置差小于阈值 则进行连续射击



```
else if (RC_Ctl.mouse.press_l == 0 && Shoot.ReverseRotation == 0) //不按
{
    waitFlag[5] = 0;
    if (Shoot.ShootContinue == 1 || ABS(Bodan_Pos - PidBodanMotorPos.SetPoint) < 1000)
    {
        PidBodanMotorPos.SetPoint = Bodan_Pos;
    }
    Shoot.ShootContinue = 0;
}
```

否则如果当鼠标左键没有按下且此时拨弹电机没有进行反转 说明此时连续射击结束 则将`waitFlag[5]`置为0 如果此时处于连续射击状态并且拨弹电机的实际位置和拨弹电机的设定位置小于1000 则将拨弹电机的设定位置设为当前拨弹电机的实际位置 为下次拨弹做准备 并取消连续射击状态